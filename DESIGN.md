# DyNN 项目模块设计说明

本文档旨在阐述 DyNN 脉冲神经网络仿真框架的模块化设计，以及各个组件的职责与相互关系。

## 1. 项目总体结构

项目根目录包含以下主要部分：

*   `dynn/`: 存放 DyNN 框架的核心库代码。
*   `experiments/`: 包含用于运行具体仿真实验的脚本。
*   `tests/`: 包含项目的单元测试和集成测试。
*   `README.md`: 项目的需求规格说明文档。
*   `requirements.txt`: 项目的 Python 依赖列表。
*   `DESIGN.md`: 本模块设计说明文档。

## 2. DyNN 核心库 (`dynn/`)

此目录是 DyNN 框架的核心，包含了实现 SNN 仿真所需的全部逻辑。

### 2.1. `__init__.py`

*   **用途**: 将 `dynn/dynn/` 目录标记为一个 Python 包，使其内部模块可以被导入。

### 2.2. `core/` - SNN 核心组件

此子模块封装了脉冲神经网络的基本构成要素和运行机制，对应 `README.md` 第2节 "SNN核心框架设计要求"。

*   `core/__init__.py`:
    *   **用途**: 将 `core/` 目录标记为一个 Python 子包。
*   `core/neurons.py`:
    *   **用途**: 定义神经元模型（如类Izhikevich模型）及其参数化。实现 `NeuronPopulation` 类来管理一组神经元，处理其状态初始化、更新和信息获取。
    *   **对应 README**: 2.1. 神经元模型。
*   `core/synapses.py`:
    *   **用途**: 定义和管理神经元之间的突触连接。包括权重的表示（如矩阵形式）、初始化策略、兴奋性/抑制性突触的区分，以及连接拓扑的灵活配置（如邻域连接、稀疏连接）。
    *   **对应 README**: 2.2. 突触与连接。
*   `core/learning_rules.py`:
    *   **用途**: 实现学习规则，特别是基于脉冲迹的 STDP（尖峰时间依赖可塑性）。包含权重更新逻辑，并提供接口以接收外部奖励信号，用于调制学习率（LTP 和 LTD）。
    *   **对应 README**: 2.3. 学习规则。
*   `core/network.py`:
    *   **用途**: 提供一个顶层的 `NeuralNetwork` 对象，用于组织和管理整个 SNN，包括注册神经元群体、突触连接和学习规则。定义网络的输入和输出点。
    *   **对应 README**: 2.4. 网络构建与管理。
*   `core/simulator.py`:
    *   **用途**: 实现离散时间的仿真引擎。控制仿真循环（如按步长 `dt` 运行），协调神经元状态更新、突触信号传播和学习规则的应用。确保核心仿真逻辑与应用场景分离。
    *   **对应 README**: 2.5. 仿真引擎。

### 2.3. `io/` - 输入/输出与环境交互接口

此子模块负责处理 SNN 与外部世界（如 OpenAI Gym 环境）之间的数据交换，对应 `README.md` 第3节 "应用接口与环境交互层设计要求" 的主要部分。

*   `io/__init__.py`:
    *   **用途**: 将 `io/` 目录标记为一个 Python 子包。
*   `io/input_encoders.py`:
    *   **用途**: 提供将外部环境的观察值或高级控制信号转换为 SNN 输入神经元活动（如注入电流或目标脉冲）的机制。针对特定环境（如 MountainCar-v0 的位置信息）实现具体的编码器。
    *   **对应 README**: 3.1. 输入接口与编码器。
*   `io/output_decoders.py`:
    *   **用途**: 提供从 SNN 输出神经元的活动中提取信息并转换为外部可理解的信号或动作（如离散动作）的机制。针对特定环境实现具体的解码器（如基于瞬时脉冲发放的决策）。
    *   **对应 README**: 3.2. 输出接口与解码器。
*   `io/reward_processors.py`:
    *   **用途**: 处理来自环境的原始奖励信号。例如，可以实现奖励的平滑处理（如滑动平均），生成用于调制学习规则的最终标量奖励信号。
    *   **对应 README**: 3.3. 奖励接口与处理。

### 2.4. `utils/` - 通用工具模块

此子模块包含框架所需的通用工具和辅助功能。

*   `utils/__init__.py`:
    *   **用途**: 将 `utils/` 目录标记为一个 Python 子包。
*   `utils/probes.py`:
    *   **用途**: 实现数据记录和监控功能。提供灵活的"探针"机制，用于在仿真过程中追踪和记录各种关键数据。
        *   定义了 `BaseProbe` 基类，提供通用功能如记录间隔控制、数据存储、数据获取 (`get_data`)、重置 (`reset`) 和CSV导出 (`export_to_csv`)。子类需实现具体的 `_collect_data` 逻辑。
        *   实现了具体的探针类：
            *   `PopulationProbe`: 用于记录神经元群体中特定状态变量（如膜电位 `v`、脉冲 `fired`）的时间序列数据。
            *   `SynapseProbe`: 用于记录突触集合的状态，例如突触权重矩阵随时间的变化。
            *   `CustomDataProbe`: 允许用户提供自定义函数来收集和记录仿真过程中的任意数据。
        *   探针实例会被注册到 `NeuralNetwork` 对象中，并在每个仿真步骤由网络协调其 `attempt_record` 方法的调用。
    *   **对应 README**: 3.4. 数据记录与监控。

### 2.5. `config.py` - 系统配置管理

*   **用途**: 集中管理整个 DyNN 框架的所有可配置参数。这包括 SNN 模型参数、连接拓扑参数、学习规则参数、输入/输出编码/解码方案参数、仿真控制参数等。支持从文件加载默认配置，并允许通过编程接口覆盖。
*   **对应 README**: 4. 系统配置与管理。

## 3. 实验脚本 (`dynn/experiments/`)

此目录用于存放具体的实验运行脚本。

*   `experiments/mountain_car_v0_experiment.py`:
    *   **用途**: 示例脚本，演示如何配置和运行 DyNN 框架来解决 "MountainCar-v0" 环境。

## 4. 测试 (`dynn/tests/`)

此目录用于存放单元测试和集成测试代码，以保证框架的质量和稳定性。

*   `tests/__init__.py`:
    *   **用途**: 将 `tests/` 目录标记为一个 Python 包，方便测试框架（如 `unittest`）发现和运行测试。
*   `tests/test_core_neurons.py`:
    *   **用途**: 示例测试文件，用于测试 `dynn.core.neurons` 模块的功能。

## 5. 根目录文件

*   `README.md`: 项目的需求规格说明，是项目开发的根本依据。
*   `requirements.txt`: 列出项目运行所需的 Python 库及其版本，如 `numpy` 和 `gymnasium`。
*   `DESIGN.md` (本文档): 对项目模块设计的详细说明。 